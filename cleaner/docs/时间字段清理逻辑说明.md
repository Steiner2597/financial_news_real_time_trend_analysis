"""
清洗逻辑修改说明 - 时间字段确认
"""

print("""
================================================================================
✅ 数据清洗逻辑 - 时间字段确认
================================================================================

【问题】：清洗旧数据时，应该使用哪个时间字段？

【答案】：使用 created_at 字段（优先），如果没有则使用 timestamp

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 字段含义说明：

1. created_at（优先使用）
   - 来源：数据原始发布时间（如 Reddit 评论的发表时间）
   - 含义：数据在原始源头的发布时间
   - 作用：代表新闻/评论的真实发布时间
   - 示例：Reddit 上发表的评论发表于 2025-11-01 10:30:00

2. timestamp（备用）
   - 来源：Cleaner 处理数据时的当前时间
   - 含义：数据被 Cleaner 处理的时间
   - 作用：追踪数据何时进入处理流程
   - 示例：Cleaner 处理该数据时的时间是 2025-11-02 15:30:00

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🧹 清洗逻辑（修改后）：

【目标】：只保留当前整点往前 24 小时的数据

【时间计算】：
  - 现在：2025-11-02 15:30:45
  - 当前整点：2025-11-02 15:00:00（向下取整到整点）
  - 保留范围起点：2025-11-01 15:00:00（当前整点 - 24 小时）
  - 保留范围：2025-11-01 15:00:00 至 现在
  - 删除范围：2025-11-01 15:00:00 之前的所有数据

【判断依据】：
  1. 先检查 created_at 字段（优先，代表真实发布时间）
  2. 如果没有 created_at，则检查 timestamp 字段
  3. 如果都没有，则跳过该数据

【删除条件】：
  data['created_at'].timestamp() < cutoff_timestamp
  
  其中：
  - cutoff_timestamp = 2025-11-01 15:00:00 的 Unix 时间戳
  - 早于这个时间的数据都会被删除

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 日志输出示例：

🧹 开始清理数据 - 仅保留当前整点往前 24 小时的数据...
   📌 时间基准字段: created_at (原始发布时间) 或 timestamp (如果无 created_at)
当前时间: 2025-11-02T15:30:45+00:00
当前整点: 2025-11-02T15:00:00+00:00
保留时间范围: 2025-11-01T15:00:00+00:00 到现在
删除阈值 (cutoff_timestamp): 1730468400.0

✅ 清理完成:
   📊 总检查数据: 18386 条
   🗑️  已删除数据: 5000 条 (发布时间 < 2025-11-01T15:00:00+00:00)
   ✨ 保留数据: 13386 条 (发布时间 >= 2025-11-01T15:00:00+00:00)
   📌 判断依据: created_at 字段 (原始发布时间) / timestamp
   🎯 时间窗口: 2025-11-01T15:00:00+00:00 到 现在

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✨ 修改代码位置：

文件: cleaner/services/cleaner.py
方法: EventDrivenCleaner._clean_old_data()

修改内容：
  - 优先使用 created_at 字段（原始发布时间）
  - 如果没有 created_at，则使用 timestamp
  - 新增详细的日志说明使用的是哪个字段
  - 完整的时间计算说明（当前整点、保留范围等）

================================================================================
""")
