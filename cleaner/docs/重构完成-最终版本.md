# âœ… Cleaner é‡æ„å®Œæˆ - æœ€ç»ˆç‰ˆæœ¬

## ğŸ‰ å·²å®Œæˆæ¸…ç†

### åˆ é™¤çš„æ—§ä¾èµ–
- âŒ `data_cleaner_module.py` - å·²å®Œå…¨ç§»é™¤ä¾èµ–
- âŒ æ—§çš„ `cursor_loop()` å¾ªç¯é€»è¾‘ - å·²åˆ é™¤
- âŒ `data_cleaner_event_driven_v2.py` - å·²é‡å‘½åä¸ºä¸»æ–‡ä»¶

### ç°åœ¨çš„æ–‡ä»¶ç»“æ„

```
cleaner/
â”œâ”€â”€ data_cleaner_event_driven.py    # ä¸»å…¥å£æ–‡ä»¶ âœ…
â”œâ”€â”€ start_cleaner.bat                # å¯åŠ¨è„šæœ¬ âœ…
â”œâ”€â”€ test_single_pass_cleaning.py     # æµ‹è¯•è„šæœ¬ âœ…
â”œâ”€â”€ config_processing.yaml           # é…ç½®æ–‡ä»¶
â”‚
â””â”€â”€ event_driven/                    # æ ¸å¿ƒæ¨¡å—
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ cleaner.py                   # ä¸»æ¸…æ´—å™¨ âœ… ä½¿ç”¨é…ç½®æ–‡ä»¶
    â”œâ”€â”€ single_pass_cleaner.py       # å•æ¬¡æ¸…æ´—å™¨ âœ… æ–°å¢
    â”œâ”€â”€ redis_manager.py             # Redis ç®¡ç†
    â”œâ”€â”€ notification_handler.py      # æ¶ˆæ¯å¤„ç†
    â”œâ”€â”€ cache_manager.py             # ç¼“å­˜ç®¡ç†
    â””â”€â”€ signal_handler.py            # ä¿¡å·å¤„ç†
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¯åŠ¨

```bash
cd cleaner
start_cleaner.bat
```

æˆ–

```bash
python data_cleaner_event_driven.py
```

### æŒ‡å®šæ¨¡å¼

```bash
# äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
python data_cleaner_event_driven.py --mode event_driven

# æŒç»­è½®è¯¢æ¨¡å¼
python data_cleaner_event_driven.py --mode continuous

# å•æ¬¡è¿è¡Œæ¨¡å¼
python data_cleaner_event_driven.py --mode once
```

## ğŸ”§ æ ¸å¿ƒæ”¹è¿›

### 1. å®Œå…¨ç‹¬ç«‹çš„é…ç½®åŠ è½½
```python
# ç›´æ¥ä» config_processing.yaml åŠ è½½
# ä¸å†ä¾èµ– data_cleaner_module
```

### 2. å•æ¬¡æ¸…æ´—é€»è¾‘
```python
# æ”¶åˆ°é€šçŸ¥ â†’ æ¸…æ´—å½“å‰é˜Ÿåˆ— â†’ å®Œæˆ â†’ å‘é€é€šçŸ¥ â†’ ç»§ç»­å¾…å‘½
# âœ… ä¸é˜»å¡å¾ªç¯
```

### 3. ç®€æ´çš„å…¥å£
```python
# data_cleaner_event_driven.py
from event_driven.cleaner import main
main()
```

## ğŸ“Š å·¥ä½œæµç¨‹

```
çˆ¬è™«å®Œæˆ
    â†“
å‘é€ 'crawler_complete' é€šçŸ¥
    â†“
æ¸…æ´—å™¨æ”¶åˆ°é€šçŸ¥
    â†“
æ‰§è¡Œ clean_once() å•æ¬¡æ¸…æ´—
    â†“
æ¸…æ´—å®Œæˆ
    â†“
å‘é€ 'cleaner_complete' é€šçŸ¥
    â†“
Processor å¼€å§‹å¤„ç†
    â†“
æ¸…æ´—å™¨ç»§ç»­å¾…å‘½ âœ… ä¸é˜»å¡
```

## âœ¨ å…³é”®ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|-----|------|
| **éé˜»å¡** | âœ… å•æ¬¡å¤„ç†ï¼Œä¸è¿›å…¥å¾ªç¯ |
| **å¿«é€Ÿå“åº”** | âœ… æ”¶åˆ°é€šçŸ¥ç«‹å³å¤„ç† |
| **å®Œæ•´é€šçŸ¥** | âœ… æ¸…æ´—å®Œæˆåå‘é€é€šçŸ¥ |
| **ç‹¬ç«‹é…ç½®** | âœ… ä¸ä¾èµ–å…¶ä»–æ¨¡å— |
| **æ‰¹é‡ä¼˜åŒ–** | âœ… 100 æ¡/æ‰¹ï¼Œå‡å°‘ Redis æ“ä½œ |
| **è¯¦ç»†ç»Ÿè®¡** | âœ… è¿”å›å¤„ç†ã€æ¸…æ´—ã€å»é‡ã€æ— æ•ˆæ•°æ®ç»Ÿè®¡ |

## ğŸ§ª æµ‹è¯•éªŒè¯

```bash
cd cleaner
python test_single_pass_cleaning.py
```

é¢„æœŸè¾“å‡ºï¼š
```
âœ“ SinglePassCleaner åˆ›å»ºæˆåŠŸ
æ‰§è¡Œå•æ¬¡æ¸…æ´—...
æ¸…æ´—ç»“æœ:
  - æ€»å¤„ç†: N
  - æ¸…æ´—æˆåŠŸ: M
  - å»é‡è¿‡æ»¤: X
  - æ— æ•ˆæ•°æ®: Y
âœ“ æ¸…æ´—å™¨å·²å…³é—­
âœ… å•æ¬¡æ¸…æ´—å™¨æµ‹è¯•é€šè¿‡ï¼
```

## ğŸ“ é…ç½®æ–‡ä»¶

`config_processing.yaml`:

```yaml
redis:
  host: "localhost"
  port: 6379
  db_in: 0                          # ä» Scraper è¯»å–
  db_out: 1                         # å‘é€ç»™ Processor
  data_queue: "data_queue"
  clean_data_queue: "clean_data_queue"
  id_cache: "cleaned_ids"
  
  notification_listen:
    enabled: true
    channel: "crawler_complete"     # ç›‘å¬çˆ¬è™«
    mode: "event_driven"
  
  notification_send:
    enabled: true
    channel: "cleaner_complete"     # é€šçŸ¥ Processor

deduplication:
  mode: "time_window"               # æ—¶é—´çª—å£å»é‡
  window_hours: 24
  clear_on_start: false
```

## ğŸ¯ å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Scraper   â”‚ çˆ¬å–æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ¨é€åˆ° Redis DB0
       â”‚ å‘é€ 'crawler_complete'
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cleaner   â”‚ å•æ¬¡æ¸…æ´— âœ…
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ¨é€åˆ° Redis DB1
       â”‚ å‘é€ 'cleaner_complete'
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Processor  â”‚ åˆ†æå¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ‰ æ€»ç»“

### å·²åˆ é™¤
- âŒ `data_cleaner_module` ä¾èµ–
- âŒ æ—§çš„å¾ªç¯é€»è¾‘
- âŒ é˜»å¡çš„æ¸…æ´—æµç¨‹

### æ–°å¢
- âœ… ç‹¬ç«‹çš„é…ç½®åŠ è½½
- âœ… å•æ¬¡æ¸…æ´—å¤„ç†å™¨
- âœ… éé˜»å¡äº‹ä»¶é©±åŠ¨
- âœ… ç®€æ´çš„å¯åŠ¨è„šæœ¬

### ç»“æœ
- ğŸš€ æ¸…æ´—å™¨ç‹¬ç«‹è¿è¡Œ
- ğŸ¯ æµç¨‹é¡ºç•…ä¸é˜»å¡
- ğŸ’ª ä»£ç ç®€æ´æ˜“ç»´æŠ¤
- ğŸ“Š è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯

**ç°åœ¨å¯ä»¥æ„‰å¿«åœ°ä½¿ç”¨å…¨æ–°çš„äº‹ä»¶é©±åŠ¨æ¸…æ´—å™¨äº†ï¼** ğŸŠ
